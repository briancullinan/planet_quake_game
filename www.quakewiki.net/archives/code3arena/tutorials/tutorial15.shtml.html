<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">

<html>

<head>
<title>Code3Arena</title>
</head>
<body background="../images/bg.gif" bgcolor="#660000" text="white" link="#C05F00" vlink="#d16545"><script type="text/javascript">document.write('<script type="text/javascript" src="http://wrapper.gamespy.com/a?pagetype=pnh_content&amp;size=prestitial"></scr' + 'ipt>');</script>

<table width="100%" border=0 cellpadding=5 cellspacing=0 align="center" background="../images/bg.gif">
<tr>
<td width=728 height=90 align="CENTER" valign="top" bgcolor=#000000>
<center><script language="javascript" type="text/javascript"> 
document.write("<"+"script type='text/javascript' src='http://wrapper.gamespy.com/a?pagetype=pnh_content&amp;size=728x90'>"); 
document.write("<"+"/script>"); 
</script>
<noscript> 
<iframe valign=top WIDTH=728 HEIGHT=90 MARGINWIDTH=0 MARGINHEIGHT=0 HSPACE=0 VSPACE=0 FRAMEBORDER=0 SCROLLING=no BORDERCOLOR="#000000" SRC="http://wrapper.gamespy.com/a?pagetype=pnh_content&amp;size=728x90&amp;sizew=728&amp;sizeh=90&amp;js=false"> 
</iframe> 
</noscript> </center>
</td>
</tr>
</table>

<br>

<table width="100%" cellspacing="0" cellpadding="0" border="1" align="center" bgcolor=#000000>
<tr>
<td align="CENTER">
<img src="../images/logo.gif" width="500" height="137" border="0" alt="Code3Arena">
</td>
</tr>
</table>

<p>

<table width="100%" cellpadding=0 cellspacing=0 border=0 bgcolor="#000000">
<tr>
<td><img src="../images/ouricon.gif"></td>
<td width="100%" bgcolor=#000000>
<font face="Verdana, Arial" size="2" color="#eeeeee"><b>
<A HREF="http://www.planetquake.com/">PlanetQuake</A> |
<A HREF="http://www.planetquake.com/code3arena">Code3Arena</A> |
<A HREF="http://www.planetquake.com/code3arena/tutorials">Tutorials</A> |
<a href="tutorial14.shtml.html"><< Prev</a> |
Tutorial 15 |
<a href="tutorial16.shtml.html">Next >></a>
</b></font>
</td>
</tr>
</table>
<p>


<table width="100%" border=0 cellpadding=0 cellspacing=0 align=center bgcolor=#4B0202>
<tr>

<td valign=top bgcolor="#000000">
<table width=150 bgcolor="#000000" valign=top border=0 cellpadding=10 cellspacing=0>
<tr>
<td bgcolor=#000000 valign=top>
<p>
<a href="https://www.quakewiki.net/archives/code3arena/index.shtml"><img src="../images/minilogo.gif" width="150" height="80" border="0" alt="menu"></a>
<p>
<font face=arial color="#C05F00" size=2>
<strong>
<LI> <a href="https://www.quakewiki.net/archives/code3arena/index.shtml">Home/News</a>
<LI> <a href="https://www.quakewiki.net/archives/code3arena/modsource.shtml">ModSource</a>
<LI> <a href="https://www.quakewiki.net/archives/code3arena/compilers.shtml">Compiling</a>
<LI> <a href="https://www.quakewiki.net/archives/code3arena/help.shtml">Help!!!</a>
<LI> <a href="https://www.quakewiki.net/archives/code3arena/submission.shtml">Submission</a>
<LI> <a href="https://www.quakewiki.net/archives/code3arena/contributors.shtml">Contributors</a>
<LI> <a href="https://www.quakewiki.net/archives/code3arena/staff.shtml">Staff</a>
<LI> <a href="https://www.quakewiki.net/archives/code3arena/downloads.shtml">Downloads</a>
</strong>
<P>
<img src="../images/tutorials.gif" width="80" height="25" border="0" alt="Tutorials">
<font color="#C05F00" size=1>
<strong>
<BR> <a href="index.html"> < Index ></a>
<BR> 1. <a href="tutorial1.shtml.html">Mod making 101</a>
<BR> 2. <a href="tutorial2.shtml.html">Up 'n running</a>
<BR> 3. <a href="tutorial3.shtml.html">Hello, QWorld!</a>
<BR> 4. <a href="tutorial4.shtml.html">Infinite Haste</a>
<BR> 5. <a href="tutorial5.shtml.html">Armor Piercing Rails</a>
<BR> 6. <a href="tutorial6.shtml.html">Bouncing Rockets</a>
<BR> 7. <a href="tutorial7.shtml.html">Cloaking</a>
<BR> 8. <a href="tutorial8.shtml.html">Ladders</a>
<BR> 9. <a href="tutorial9.shtml.html">Favourite Server</a>
<BR> 10. <a href="tutorial10.shtml.html">Flame Thrower</a>
<BR> 11. <a href="tutorial11.shtml.html">Vortex Grenades</a>
<BR> 12. <a href="tutorial12.shtml.html">Grapple</a>
<BR> 13. <a href="tutorial13.shtml.html">Lightning Discharge</a>
<BR> 14. <a href="tutorial14.shtml.html">Locational Damage</a>
<BR> 15. <a href="tutorial15.shtml.html">Leg Shots</a>
<BR> 16. <a href="tutorial16.shtml.html">Weapon Switching</a>
<BR> 17. <a href="tutorial17.shtml.html">Scoreboard frag-rate</a>
<BR> 18. <a href="tutorial18.shtml.html">Vortex Grenades II</a>
<BR> 19. <a href="tutorial19.shtml.html">Vulnerable Missiles</a>
<BR> 20. <a href="tutorial20.shtml.html">Creating Classes</a>
<BR> 21. <a href="tutorial21.shtml.html">Scrolling Credits</a>
<BR> 22. <a href="tutorial22.shtml.html">Weapon Dropping</a>
<BR> 23. <a href="tutorial23.shtml.html">Anti-Gravity Boots</a>
<BR> 24. <a href="tutorial24.shtml.html">HUD scoreboard</a>
<BR> 25. <a href="tutorial25.shtml.html">Flashlight and laser</a>
<BR> 26. <a href="tutorial26.shtml.html">Weapon Positioning</a>
<BR> 27. <a href="tutorial27.shtml.html">Weapon Reloading</a>
<BR> 28. <a href="tutorial28.shtml.html">Progressive Zooming</a>
<BR> 29. <a href="tutorial29.shtml.html">Rotating Doors</a>
<BR> 30. <a href="tutorial30.shtml.html">Beheading (headshot!)</a>
<BR> 31. <a href="tutorial31.shtml.html">Alt Weapon Fire</a>
<BR> 32. <a href="tutorial32.shtml.html">Popup Menus I</a>
<BR> 33. <a href="tutorial33.shtml.html">Popup Menus II</a>
<BR> 34. <a href="tutorial34.shtml.html">Cluster Grenades</a>
<BR> 35. <a href="tutorial35.shtml.html">Homing Rockets</a>
<BR> 36. <a href="tutorial36.shtml.html">Spreadfire Powerup</a>
<BR> 37. <a href="tutorial37.shtml.html">Instagib gameplay</a>
<BR> 38. <a href="tutorial38.shtml.html">Accelerating rockets</a>
<BR> 39. <a href="tutorial39.shtml.html">Server only Instagib</a>
<BR> 40. <a href="tutorial40.shtml.html">Advanced Grapple Hook</a>
<BR> 41. <a href="tutorial41.shtml.html">Unlagging your mod</a>
</strong>
</font>
<p><br>
<img src="../images/articles.gif" width="80" height="25" border="0" alt="Articles">
<font color="#C05F00" size=1>
<strong>
<BR> <a href="https://www.quakewiki.net/archives/code3arena/articles/index.html"> < Index > </a>
<BR> 1. <a href="https://www.quakewiki.net/archives/code3arena/articles/article1.shtml">Entities</A>
<BR> 2. <a href="https://www.quakewiki.net/archives/code3arena/articles/article2.shtml">Vectors</A>
<BR> 3. <a href="https://www.quakewiki.net/archives/code3arena/articles/article3.shtml">Good Coding</A>
<BR> 4. <a href="https://www.quakewiki.net/archives/code3arena/articles/article4.shtml">Compilers I</A>
<BR> 5. <a href="https://www.quakewiki.net/archives/code3arena/articles/article5.shtml">Compilers II</A>
<BR> 6. <a href="https://www.quakewiki.net/archives/code3arena/articles/article6.shtml">UI Menu Primer I</A>
<BR> 7. <a href="https://www.quakewiki.net/archives/code3arena/articles/article7.shtml">UI Menu Primer II</A>
<BR> 8. <a href="https://www.quakewiki.net/archives/code3arena/articles/article8.shtml">UI Menu Primer III</A>
<BR> 9. <a href="https://www.quakewiki.net/archives/code3arena/articles/article9.shtml">QVM Communication, Cvars, commands</A>
<BR> 10. <a href="https://www.quakewiki.net/archives/code3arena/articles/article10.shtml">Metrowerks CodeWarrior</A>
<BR> 11. <a href="https://www.quakewiki.net/archives/code3arena/articles/article11.shtml">1.27g code, bugs, batch</A>
</strong>
</font>
<p>

<br>
<img src="../images/links.gif" width="80" height="25" border="0" alt="Links">
<font color="#C05F00">
<small>
<li><a href="http://www.planetquake.com/quake3/files.shtml">Quake3 Files</a>
<li><a href="http://forums.planetquake.com/">Quake3 Forums</a>
<li><a href="tutorial15.shtml.html#">Q3A Editing Message Board</a>
<li><a href="http://www.planetquake.com/quake3/hosted/editing.shtml">Quake3 Editing</a>
</small>
</font>
<p><br>
<img src="../images/feedback.gif" width="80" height="25" border="0" alt="Feedback">
<font color="#C05F00">
<small>
<li><a href="mailto:sumfuka@planetquake.com">SumFuka</A>
<li><a href="mailto:calrathan@captured.com">Calrathan</A>
<li><a href="mailto:hypothermia@planetquake.com">
<font color="#FF0000">H</font><font color="#FFFF00">y</font><font color="#CC33CC">p</font><font color="#3333FF">o</font>Thermia
</A>
<li><a href="mailto:warzone@planetquake.com">WarZone</A>
</small>
</font>
<p><br>
<p><br><br><br>
<small>Site Design by:</small>
<br>
<a href="mailto:ladyice@planetice.org,jeh@planetjeh.com"><img src="../images/icelogo_sm.jpg" width="88" height="31" border="0" align="middle" alt="ICEmosis Design"></a>
</font>
<br><br>
</td>
</tr>
</table>
</td>


<td valign=top background="../images/bg.gif">
<table width=20 cellpadding=0 cellspacing=0 border=0 background="../images/bg.gif">
<tr>
<td background="../images/bg.gif">
&nbsp;
</td>
</tr>
</table>
</td>


<td valign=top bgcolor=#000000>
<table width="100%" cellpadding=15 cellspacing=10 border=0 bgcolor=#000000 valign=top>
<tr>
<td valign=top>
<font face="Verdana, Arial" size="2" color="#eeeeee">
<center><b><font color="#C05F00" size=5>
TUTORIAL 15 - Leg Shots
</font></b><br>by <b><a href="mailto:goin0004@itlabs.umn.edu">McBain</A></b></center><p>
<font color="#E07F44"><H4>
1. Pre-requisite Tutorial
</H4></font>
[Ed's note: You need to implement a locational damage tutoroial first. We have used
<A HREF="tutorial14.shtml.html">Tutorial 14</A> by Calrathan or you can
use your own locational damage code - just hook it in like below. We've also
got foot shots in our locational damage, which also slow you down. Thanks
to McBain for letting us post his code - Sum].<P>
I thought it would be cool to make leg damage slow the player down.
When the player picks up health it returns their speed.
You can easily make this so that any damage slows the player.<P>
<font color="#E07F44"><H4>
2. Reduce Speed When Hit
</H4></font>
First go to g_combat.c in the game project.<P>
If you have done the above tutorial the code should look like this:<P>
<font face="Verdana, Arial" size="3" color="#ffffcc"><pre>
               // Check the location ignoring the rotation info
                    switch ( targ->client->lasthurt_location & 
                                    ~(LOCATION_BACK | LOCATION_LEFT | LOCATION_RIGHT | LOCATION_FRONT) )
                    {
                    case LOCATION_HEAD:
                            take *= 1.8;
                            break;
                    case LOCATION_FACE:
                            if (targ->client->lasthurt_location & LOCATION_FRONT)
                                    take *= 5.0; // Faceshots REALLY suck
                            else
                                    take *= 1.8;
                            break;
                    case LOCATION_SHOULDER:
                            if (targ->client->lasthurt_location & (LOCATION_FRONT | LOCATION_BACK))
                                    take *= 1.4; // Throat or nape of neck
                            else
                                    take *= 1.1; // Shoulders
                            break;
                    case LOCATION_CHEST:
                            if (targ->client->lasthurt_location & (LOCATION_FRONT | LOCATION_BACK))
                                    take *= 1.3; // Belly or back
                            else
                                    take *= 0.8; // Arms
                            break;
                    case LOCATION_STOMACH:
                            take *= 1.2;
                            break;
                    case LOCATION_GROIN:
                            if (targ->client->lasthurt_location & LOCATION_FRONT)
                                    take *= 1.3; // Groin shot
                            break;
                    case LOCATION_LEG:
                            take *= 0.7;
                            break;
                    case LOCATION_FOOT:
                            take *= 0.5;
                            break;

                    }
</pre></font>
The locational damage checks for leg hits on the lower part of the body (the actual
percentage varies when the player crouches and does 70% damage to the legs and 50% damage to the foot.
You can change these however you want.<P>
Now to make the leg damage slow the player down add this line just
under <b>take *= 0.7;</b> and <b>take *= 0.7;</b> .
<font face="Verdana, Arial" size="3" color="#ffffcc"><pre>
                    case LOCATION_GROIN:
                            if (targ->client->lasthurt_location & LOCATION_FRONT)
                                    take *= 1.3; // Groin shot
                            break;
                    case LOCATION_LEG:
                            take *= 0.7;
<font color="#ff6060">                            targ->client->ps.speed -= take; // slowdown if shot in legs, McBain</font>
                            break;
                    case LOCATION_FOOT:
                            take *= 0.5;
<font color="#ff6060">                            targ->client->ps.speed -= take; // slowdown if shot in foot, McBain</font>
                            break;
	}
</pre></font>
This is pretty self explanatory. targ is the damaged player and the
speed is decreased by the amount of damage taken. You could scale that however you want.<P>
<font color="#E07F44"><H4>
3. Reset Speed At Respawn
</H4></font>
Now open g_client.c and go to the ClientSpawn function. Change the
code as follows:
<font face="Verdana, Arial" size="3" color="#ffffcc"><pre>
	// health will count down towards max_health
	ent->health = client->ps.stats[STAT_HEALTH] = client->ps.stats[STAT_MAX_HEALTH] * 1.25;

<font color="#ff6060">	// return to normal speed, McBain
	client->ps.speed = g_speed.value;</font>

	G_SetOrigin( ent, spawn_origin );
	VectorCopy( spawn_origin, client->ps.origin );
</pre></font>
This just means that the players speed will return to the server's
normal value when the player spawns (after a death obviously).<P>
<font color="#E07F44"><H4>
4. Regain Speed On Health Pickup
</H4></font>
Now go to g_items.c go to the Pickup_Health function and add my code
here:
<font face="Verdana, Arial" size="3" color="#ffffcc"><pre>
	if ( ent->count ) {
		quantity = ent->count;
	} else {
		quantity = ent->item->quantity;
	}

	other->health += quantity;

<font color="#ff6060">	// return speed upon health pickup or more than maximum health, McBain
	other->client->ps.speed += quantity;
	if (other->client->ps.speed > g_speed.value) {
		other->client->ps.speed = g_speed.value;
	}

	if (other->health >= other->client->ps.stats[STAT_MAX_HEALTH]) {
		other->client->ps.speed = g_speed.value;
	}
	// end McBain</font>

	if (other->health > max ) {
		other->health = max;
	}
</pre></font>
This just makes it so that if the player picks up health they get that
much speed back. If the player picks up health and gets to 100 or more health they go to
maximum speed.<P>
The only thing this code doesn't do is make it so if you picked up a
megahealth and got leg damage, you may have more than 100 health and run slower, but this
is easily fixed. I will leave that to the reader (I hate when people say that). Besides
all you would have to do is pick up a health and you would be back to normal speed.<P>
<font color="#E07F44"><H4>
5. One More Fix
</H4></font>
One last thing. The Quake code updates player speed during every
"player think" mostly to check for the haste power-up. You need to make it so it doesn't
change the player speed since we made want it to get slower.
Open up g_active.c, go to the ClientThink_real function and comment
this out like below:
<font face="Verdana, Arial" size="3" color="#ffffcc"><pre>
	client->ps.gravity = g_gravity.value;

	// set speed
<font color="#ff6060">	// out by McBain for speed damage
//	client->ps.speed = g_speed.value;</font>
	
	if ( client->ps.powerups[PW_HASTE] ) {
		client->ps.speed *= 1.3;
	}
</pre></font>
Notice haste still makes you 1.3 times faster.<P>
Props to wchar_t* for the location damage tutorial. <P>
<p>
</td>
</tr>
</table>

</tr>
</table>
<p>

<table width="100%" cellpadding=0 cellspacing=0 border=0 bgcolor="#000000">
<tr>
<td><img src="../images/ouricon.gif"></td>
<td width="100%" bgcolor=#000000>
<font face="Verdana, Arial" size="2" color="#eeeeee"><b>
<A HREF="http://www.planetquake.com/">PlanetQuake</A> |
<A HREF="http://www.planetquake.com/code3arena">Code3Arena</A> |
<A HREF="http://www.planetquake.com/code3arena/tutorials">Tutorials</A> |
<a href="tutorial14.shtml.html"><< Prev</a> |
Tutorial 15 |
<a href="tutorial16.shtml.html">Next >></a>
</b></font>
</td>
</tr>
</table>
<p>

</body>

</html>
