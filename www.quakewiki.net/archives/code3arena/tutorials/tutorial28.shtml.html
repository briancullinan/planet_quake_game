<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">

<html>

<head>
<title>Code3Arena</title>
</head>
<body background="../images/bg.gif" bgcolor="#660000" text="white" link="#C05F00" vlink="#d16545"><script type="text/javascript">document.write('<script type="text/javascript" src="http://wrapper.gamespy.com/a?pagetype=pnh_content&amp;size=prestitial"></scr' + 'ipt>');</script>

<table width="100%" border=0 cellpadding=5 cellspacing=0 align="center" background="../images/bg.gif">
<tr>
<td width=728 height=90 align="CENTER" valign="top" bgcolor=#000000>
<center><script language="javascript" type="text/javascript"> 
document.write("<"+"script type='text/javascript' src='http://wrapper.gamespy.com/a?pagetype=pnh_content&amp;size=728x90'>"); 
document.write("<"+"/script>"); 
</script>
<noscript> 
<iframe valign=top WIDTH=728 HEIGHT=90 MARGINWIDTH=0 MARGINHEIGHT=0 HSPACE=0 VSPACE=0 FRAMEBORDER=0 SCROLLING=no BORDERCOLOR="#000000" SRC="http://wrapper.gamespy.com/a?pagetype=pnh_content&amp;size=728x90&amp;sizew=728&amp;sizeh=90&amp;js=false"> 
</iframe> 
</noscript> </center>
</td>
</tr>
</table>

<br>

<table width="100%" cellspacing="0" cellpadding="0" border="1" align="center" bgcolor=#000000>
<tr>
<td align="CENTER">
<img src="../images/logo.gif" width="500" height="137" border="0" alt="Code3Arena">
</td>
</tr>
</table>

<p>

<table width="100%" cellpadding=0 cellspacing=0 border=0 bgcolor="#000000">
<tr>
<td><img src="../images/ouricon.gif"></td>
<td width="100%" bgcolor=#000000>
<font face="Verdana, Arial" size="2" color="#eeeeee"><b>
<A HREF="http://www.planetquake.com/">PlanetQuake</A> |
<A HREF="http://www.planetquake.com/code3arena">Code3Arena</A> |
<A HREF="http://www.planetquake.com/code3arena/tutorials">Tutorials</A> |
<a href="tutorial27.shtml.html"><< Prev</a> |
Tutorial 28 |
<a href="tutorial29.shtml.html">Next >></a>
</b></font>
</td>
</tr>
</table>
<p>


<table width="100%" border=0 cellpadding=0 cellspacing=0 align=center bgcolor=#4B0202>
<tr>

<td valign=top bgcolor="#000000">
<table width=150 bgcolor="#000000" valign=top border=0 cellpadding=10 cellspacing=0>
<tr>
<td bgcolor=#000000 valign=top>
<p>
<a href="https://www.quakewiki.net/archives/code3arena/index.shtml"><img src="../images/minilogo.gif" width="150" height="80" border="0" alt="menu"></a>
<p>
<font face=arial color="#C05F00" size=2>
<strong>
<LI> <a href="https://www.quakewiki.net/archives/code3arena/index.shtml">Home/News</a>
<LI> <a href="https://www.quakewiki.net/archives/code3arena/modsource.shtml">ModSource</a>
<LI> <a href="https://www.quakewiki.net/archives/code3arena/compilers.shtml">Compiling</a>
<LI> <a href="https://www.quakewiki.net/archives/code3arena/help.shtml">Help!!!</a>
<LI> <a href="https://www.quakewiki.net/archives/code3arena/submission.shtml">Submission</a>
<LI> <a href="https://www.quakewiki.net/archives/code3arena/contributors.shtml">Contributors</a>
<LI> <a href="https://www.quakewiki.net/archives/code3arena/staff.shtml">Staff</a>
<LI> <a href="https://www.quakewiki.net/archives/code3arena/downloads.shtml">Downloads</a>
</strong>
<P>
<img src="../images/tutorials.gif" width="80" height="25" border="0" alt="Tutorials">
<font color="#C05F00" size=1>
<strong>
<BR> <a href="index.html"> < Index ></a>
<BR> 1. <a href="tutorial1.shtml.html">Mod making 101</a>
<BR> 2. <a href="tutorial2.shtml.html">Up 'n running</a>
<BR> 3. <a href="tutorial3.shtml.html">Hello, QWorld!</a>
<BR> 4. <a href="tutorial4.shtml.html">Infinite Haste</a>
<BR> 5. <a href="tutorial5.shtml.html">Armor Piercing Rails</a>
<BR> 6. <a href="tutorial6.shtml.html">Bouncing Rockets</a>
<BR> 7. <a href="tutorial7.shtml.html">Cloaking</a>
<BR> 8. <a href="tutorial8.shtml.html">Ladders</a>
<BR> 9. <a href="tutorial9.shtml.html">Favourite Server</a>
<BR> 10. <a href="tutorial10.shtml.html">Flame Thrower</a>
<BR> 11. <a href="tutorial11.shtml.html">Vortex Grenades</a>
<BR> 12. <a href="tutorial12.shtml.html">Grapple</a>
<BR> 13. <a href="tutorial13.shtml.html">Lightning Discharge</a>
<BR> 14. <a href="tutorial14.shtml.html">Locational Damage</a>
<BR> 15. <a href="tutorial15.shtml.html">Leg Shots</a>
<BR> 16. <a href="tutorial16.shtml.html">Weapon Switching</a>
<BR> 17. <a href="tutorial17.shtml.html">Scoreboard frag-rate</a>
<BR> 18. <a href="tutorial18.shtml.html">Vortex Grenades II</a>
<BR> 19. <a href="tutorial19.shtml.html">Vulnerable Missiles</a>
<BR> 20. <a href="tutorial20.shtml.html">Creating Classes</a>
<BR> 21. <a href="tutorial21.shtml.html">Scrolling Credits</a>
<BR> 22. <a href="tutorial22.shtml.html">Weapon Dropping</a>
<BR> 23. <a href="tutorial23.shtml.html">Anti-Gravity Boots</a>
<BR> 24. <a href="tutorial24.shtml.html">HUD scoreboard</a>
<BR> 25. <a href="tutorial25.shtml.html">Flashlight and laser</a>
<BR> 26. <a href="tutorial26.shtml.html">Weapon Positioning</a>
<BR> 27. <a href="tutorial27.shtml.html">Weapon Reloading</a>
<BR> 28. <a href="tutorial28.shtml.html">Progressive Zooming</a>
<BR> 29. <a href="tutorial29.shtml.html">Rotating Doors</a>
<BR> 30. <a href="tutorial30.shtml.html">Beheading (headshot!)</a>
<BR> 31. <a href="tutorial31.shtml.html">Alt Weapon Fire</a>
<BR> 32. <a href="tutorial32.shtml.html">Popup Menus I</a>
<BR> 33. <a href="tutorial33.shtml.html">Popup Menus II</a>
<BR> 34. <a href="tutorial34.shtml.html">Cluster Grenades</a>
<BR> 35. <a href="tutorial35.shtml.html">Homing Rockets</a>
<BR> 36. <a href="tutorial36.shtml.html">Spreadfire Powerup</a>
<BR> 37. <a href="tutorial37.shtml.html">Instagib gameplay</a>
<BR> 38. <a href="tutorial38.shtml.html">Accelerating rockets</a>
<BR> 39. <a href="tutorial39.shtml.html">Server only Instagib</a>
<BR> 40. <a href="tutorial40.shtml.html">Advanced Grapple Hook</a>
<BR> 41. <a href="tutorial41.shtml.html">Unlagging your mod</a>
</strong>
</font>
<p><br>
<img src="../images/articles.gif" width="80" height="25" border="0" alt="Articles">
<font color="#C05F00" size=1>
<strong>
<BR> <a href="https://www.quakewiki.net/archives/code3arena/articles/index.html"> < Index > </a>
<BR> 1. <a href="https://www.quakewiki.net/archives/code3arena/articles/article1.shtml">Entities</A>
<BR> 2. <a href="https://www.quakewiki.net/archives/code3arena/articles/article2.shtml">Vectors</A>
<BR> 3. <a href="https://www.quakewiki.net/archives/code3arena/articles/article3.shtml">Good Coding</A>
<BR> 4. <a href="https://www.quakewiki.net/archives/code3arena/articles/article4.shtml">Compilers I</A>
<BR> 5. <a href="https://www.quakewiki.net/archives/code3arena/articles/article5.shtml">Compilers II</A>
<BR> 6. <a href="https://www.quakewiki.net/archives/code3arena/articles/article6.shtml">UI Menu Primer I</A>
<BR> 7. <a href="https://www.quakewiki.net/archives/code3arena/articles/article7.shtml">UI Menu Primer II</A>
<BR> 8. <a href="https://www.quakewiki.net/archives/code3arena/articles/article8.shtml">UI Menu Primer III</A>
<BR> 9. <a href="https://www.quakewiki.net/archives/code3arena/articles/article9.shtml">QVM Communication, Cvars, commands</A>
<BR> 10. <a href="https://www.quakewiki.net/archives/code3arena/articles/article10.shtml">Metrowerks CodeWarrior</A>
<BR> 11. <a href="https://www.quakewiki.net/archives/code3arena/articles/article11.shtml">1.27g code, bugs, batch</A>
</strong>
</font>
<p>

<br>
<img src="../images/links.gif" width="80" height="25" border="0" alt="Links">
<font color="#C05F00">
<small>
<li><a href="http://www.planetquake.com/quake3/files.shtml">Quake3 Files</a>
<li><a href="http://forums.planetquake.com/">Quake3 Forums</a>
<li><a href="tutorial28.shtml.html#">Q3A Editing Message Board</a>
<li><a href="http://www.planetquake.com/quake3/hosted/editing.shtml">Quake3 Editing</a>
</small>
</font>
<p><br>
<img src="../images/feedback.gif" width="80" height="25" border="0" alt="Feedback">
<font color="#C05F00">
<small>
<li><a href="mailto:sumfuka@planetquake.com">SumFuka</A>
<li><a href="mailto:calrathan@captured.com">Calrathan</A>
<li><a href="mailto:hypothermia@planetquake.com">
<font color="#FF0000">H</font><font color="#FFFF00">y</font><font color="#CC33CC">p</font><font color="#3333FF">o</font>Thermia
</A>
<li><a href="mailto:warzone@planetquake.com">WarZone</A>
</small>
</font>
<p><br>
<p><br><br><br>
<small>Site Design by:</small>
<br>
<a href="mailto:ladyice@planetice.org,jeh@planetjeh.com"><img src="../images/icelogo_sm.jpg" width="88" height="31" border="0" align="middle" alt="ICEmosis Design"></a>
</font>
<br><br>
</td>
</tr>
</table>
</td>


<td valign=top background="../images/bg.gif">
<table width=20 cellpadding=0 cellspacing=0 border=0 background="../images/bg.gif">
<tr>
<td background="../images/bg.gif">
&nbsp;
</td>
</tr>
</table>
</td>


<td valign=top bgcolor=#000000>
<table width="100%" cellpadding=15 cellspacing=10 border=0 bgcolor=#000000 valign=top>
<tr>
<td valign=top>
<font face="Verdana, Arial" size="2" color="#eeeeee">
<center><b><font color="#C05F00" size=5>
TUTORIAL 28 - Progressive zooming (&agrave; la UT)
</font></b><br>by <b><a href="mailto:kilderean@planetquake.com">Kilderean</A></b></center><p>
This tutorial will show you how to modify the zooming functions
so that a progressive zoom can be achieved similar to the zooming
in Unreal Tournament.<p>
This is a pretty simple tutorial, so newbies shouldn't have any
problem with the copy-pasting involved. :)
<p>&nbsp;
<font color="#E07F44"><H4>
1. Adding some new variables and making some small changes
</H4></font>
Open up cg_local.h and at around line ~29 you should see these lines:<p>
<font face="Verdana, Arial" size="3" color="#ffffcc"><pre>
#define	ITEM_SCALEUP_TIME		1000
#define	ZOOM_TIME			150
#define	ITEM_BLOB_TIME		200
</pre></font>
Make the following changes:<p>
<font face="Verdana, Arial" size="3" color="#ffffcc"><pre>
#define	ITEM_SCALEUP_TIME		1000
<font color="#ff6060">#define	ZOOM_TIME			500</font>
<font color="#ff6060">#define	ZOOM_TIME_OUT		200</font>
#define	ITEM_BLOB_TIME		200
</pre></font>
What we did is make the zoom in time a little bit longer, 500 milliseconds (half a second),
so that the player can set the zoom more easily. We also added a new define
for the time it takes to come out of zoom, since coming out of zoom needs to be done
faster than zooming in we set it to 200 milliseconds (1/5 of a second).<p>
Next go around line ~421 inside struct cg_t, and find these lines of code:<p>
<font face="Verdana, Arial" size="3" color="#ffffcc"><pre>
// zoom key
qboolean		zoomed;
int		zoomTime;
float		zoomSensitivity;
</pre></font>
Make the following changes:<p>
<font face="Verdana, Arial" size="3" color="#ffffcc"><pre>
// zoom key
qboolean		zoomed;
int		zoomTime;
float		zoomSensitivity;
<font color="#ff6060">qboolean		zooming;</font>
<font color="#ff6060">int		setZoomFov;</font>
</pre></font>
We will need the zooming boolean to determine if the player is currently zooming in and
the setZoomFov integer to remember the zoom FOV the player sets when he releases his zoom key.
<p>&nbsp;
<font color="#E07F44"><H4>
2. Finding and modifying the zoom control functions
</H4></font>
First open up cg_view.c and find the 2 zooming functions around line ~423.
You should see the 2 functions called by the +zoom and -zoom button
and they should look like this:<P>
<font face="Verdana, Arial" size="3" color="#ffffcc"><pre>
void CG_ZoomDown_f( void ) { 
	if ( cg.zoomed ) {
		return;
	}
	cg.zoomed = qtrue;
	cg.zoomTime = cg.time;
}

void CG_ZoomUp_f( void ) { 
	if ( !cg.zoomed ) {
		return;
	}
	cg.zoomed = qfalse;
	cg.zoomTime = cg.time;
}
</pre></font>
Now these functions are pretty straightforward, when you hold down the zoom
button (CG_ZoomDown is called) if you are currently zooming the
function returns, if not it sets the zoomed boolean to true and
sets a timer for the zooming animation. If you release the zooming
button (CG_ZoomUP is called) the function checks if we were zooming,
if not it returns and does nothing, if yes it sets the zoomed boolean
to false and sets a timer for the out of zoom animation.<p>
What we will do is replace these 2 functions entirely so that when we press the
zoom button it starts zooming in but when we release it it stops
and waits for another hit on the zoom button to come out of zoom.
Replace the 2 zoom functions with these:<p>
<font face="Verdana, Arial" size="3" color="#ff6060"><pre>
void CG_ZoomDown_f( void ) { 
	if ( cg.zoomed && !cg.zooming ) {
	cg.zoomed = qfalse;
	cg.zoomTime = cg.time;
	}
	else{
		if(cg.zoomed)
			return;
		cg.zoomed = qtrue;
		cg.zooming = qtrue;
		cg.zoomTime = cg.time;
	}
}
void CG_ZoomUp_f( void ) {
	if(cg.zoomed){
		cg.zoomTime=0;
		cg.zooming=qfalse;
	}
}
</pre></font>
Lets check out what we just did:<p>
First when someone presses the zoom button we check if
we are currently zoomed in and if we aren't zooming in anymore. If this is the case then
the player was zoomed in on something and he pressed the zoom button to zoom out. We then
set zoomed to false and set the timer for the zooming out animation. If the first condition
is not met, (e.g.:we are not currently zoomed in or we are but we are still zooming in) then
we check we actually aren't zoomed, if we are we return, if not we set the zoom in variables.<p>
Lastly when the player releases the zoom button the only thing we check for is if we are zoomed
on something, if we are we stop the zoom where we are and let it stay there.
<p>&nbsp;
<font color="#E07F44"><H4>
3. Modifying the zooming function
</H4></font>
Now that we made all the small changes lets modify the function that actually does the zooming. Still
in cg_view.c, go to line ~485 in the CG_CalcFov() function and find the following bit of code:<p>
<font face="Verdana, Arial" size="3" color="#ffffcc"><pre>
if ( cg.zoomed ) {
	f = ( cg.time - cg.zoomTime ) / (float)ZOOM_TIME;
	if ( f > 1.0 ) {
		fov_x = zoomFov;
	} else {
		fov_x = fov_x + f * ( zoomFov - fov_x );
	}
} else {
	f = ( cg.time - cg.zoomTime ) / (float)ZOOM_TIME;
	if ( f > 1.0 ) {
		fov_x = fov_x;
	} else {
		fov_x = zoomFov + f * ( fov_x - zoomFov );
	}
}
</pre></font>
And replace it with this segment of code:<p>
<font face="Verdana, Arial" size="3" color="#ff6060"><pre>
if ( cg.zoomed ) {
	if (cg.zoomTime != 0)
		f = ( cg.time - cg.zoomTime ) / (float)ZOOM_TIME;
	else
		f=-1;
	if ( f > 1.0 ) {
		fov_x = zoomFov;
		cg.setZoomFov = fov_x;
	} else {
		if(f!=-1){
			fov_x = fov_x + f * ( zoomFov - fov_x );
			cg.setZoomFov = fov_x;
		}
		else
			fov_x = cg.setZoomFov;
	}
} else {
	f = ( cg.time - cg.zoomTime ) / (float)ZOOM_TIME_OUT;
	if ( f > 1.0 ) {
		fov_x = fov_x;
	} else {
		fov_x = cg.setZoomFov + f * ( fov_x - cg.setZoomFov );
	}
}
</pre></font>
First what we do here is we check if we are still zooming or if we have stopped zooming in (zoomTime==0).
If we are still zooming in we run the function as it normally would be run. When we stop zooming in we
set the setZoomFov variable to the current fov we have achieved so that when we zoom out we can start
at this fov.
<p>&nbsp;
<font color="#E07F44"><H4>
4. Other cool things
</H4></font>
<p>You can now adjust the maximum amount of zoom by modifying the cg_zoomFov variable
from the console. If you make it a small value then zoom in and out
moves to useful intermediate positions very quickly.
<p>There are other cool things you can do with the zoom. For instance you can change the crosshair in cg_draw.c and
you can also draw an index to indicate the current magnification of the zoom.<p>
Those things *might* be covered in a future tutorial by me :) so check back on C3A often!<p>
<i>Et voil&agrave;!</i> Have fun!<p>
<p>
</td>
</tr>
</table>

</tr>
</table>
<p>

<table width="100%" cellpadding=0 cellspacing=0 border=0 bgcolor="#000000">
<tr>
<td><img src="../images/ouricon.gif"></td>
<td width="100%" bgcolor=#000000>
<font face="Verdana, Arial" size="2" color="#eeeeee"><b>
<A HREF="http://www.planetquake.com/">PlanetQuake</A> |
<A HREF="http://www.planetquake.com/code3arena">Code3Arena</A> |
<A HREF="http://www.planetquake.com/code3arena/tutorials">Tutorials</A> |
<a href="tutorial27.shtml.html"><< Prev</a> |
Tutorial 28 |
<a href="tutorial29.shtml.html">Next >></a>
</b></font>
</td>
</tr>
</table>
<p>

</body>

</html>
